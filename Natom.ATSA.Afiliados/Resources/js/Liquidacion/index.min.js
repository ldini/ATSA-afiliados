$(document).ready(function(){function n(n){return puede=!1,$.ajax({type:"POST",async:!1,url:"Liquidacion/SePuedenDescargarTxt",data:JSON.stringify({id:n}),dataType:"json",contentType:"application/json",success:function(n,t){t=="success"?n.success?puede=!0:Mensajes.MostrarError(n.error):Mensajes.MostrarError("Se ha producido un error. Comuníquese con el administrador de ATSA.")}}),puede}$("#Mes, #Anio").chosen();$("#Mes, #Anio").change(function(){$("#tbl").DataTable().ajax.url("Liquidacion/ObtenerListadoIndex?mes="+$("#Mes").val()+"&anio="+$("#Anio").val());$("#tbl").DataTable().ajax.reload()});$("#btnImprimir").click(function(){var n=parseInt($("#Mes").val()),t=parseInt($("#Anio").val()),i="Liquidacion/ImprimirAnual?mes="+n.toString()+"&anio="+t.toString();window.open(i,"_blank")});var t=$("#tbl").dataTable({bProcessing:!0,bServerSide:!0,ajax:{url:"Liquidacion/ObtenerListadoIndex",type:"POST"},bLengthChange:!0,bFilter:!0,bSort:!0,bInfo:!0,order:[[4,"desc"]],aoColumns:[{bSortable:!1,sWidth:"10%"},{bSortable:!1,sWidth:"10%"},{bSortable:!1,sWidth:"20%"},{bSortable:!1,sWidth:"26%"},{bSortable:!0,sWidth:"34%",mRender:function(n,t,i){var r="",u=i[5],f=i[6];return r+='<a class="btn btn-warning btn-xs btn-ver-cambios" id="'+n+'" data-toggle="tooltip" title="Ver historial de cambios")><span class="glyphicon glyphicon-time"><\/span><\/a>',u?r+='&nbsp;<a class="btn btn-danger btn-xs">Anulada<\/a>':f?r+='&nbsp;<a class="btn btn-success btn-xs">Confirmada<\/a>':(r+='&nbsp;<a class="btn btn-info btn-xs btn-txt" id="'+n+'"><span class="glyphicon glyphicon-arrow-down"><\/span> TXT<\/a>',r+='&nbsp;<a class="btn btn-success btn-xs btn-confirmar" id="'+n+'"><span class="glyphicon glyphicon-ok"><\/span> Transferencias<\/a>',r+='&nbsp;<a class="btn btn-danger btn-xs btn-eliminar" id="'+n+'">Eliminar<\/a>',r+='&nbsp;<a class="btn btn-warning btn-xs btn-editar" id="'+n+'">Editar<\/a>'),r+('&nbsp;<a class="btn btn-primary btn-xs btn-imprimir" id="'+n+'">Imprimir<\/a>')}}]});$("#tbl").on("click",".btn-editar",function(n){var t=n.currentTarget.id;location.href="Liquidacion/Edit?id="+t.toString()});$("#tbl").on("click",".btn-email",function(n){var t=n.currentTarget.id;$.ajax({type:"POST",url:"Liquidacion/EnviarPorEmail",data:JSON.stringify({id:t}),dataType:"json",contentType:"application/json",success:function(n,t){t=="success"?n.success||Mensajes.MostrarError(n.error):Mensajes.MostrarError("Se ha producido un error. Comuníquese con el administrador de ATSA.")}})});$("#tbl").on("click",".btn-imprimir",function(n){var t=n.currentTarget.id;window.open("Liquidacion/Imprimir?id="+t.toString(),"_blank")});$("#tbl").on("click",".btn-txt",function(t){var i=t.currentTarget.id;n(i)&&(window.open("Liquidacion/DescargarTxt?id="+i.toString(),"_blank"),window.open("Liquidacion/DescargarTxt3ros?id="+i.toString(),"_blank"))});$("#tbl").on("click",".btn-confirmar",function(n){var t=n.currentTarget.id;Mensajes.MostrarSiNo("¿Confirmar transferencias?",function(){$.ajax({type:"POST",url:"Liquidacion/ConfirmarTransferencias",data:JSON.stringify({id:t}),dataType:"json",contentType:"application/json",beforeSend:function(){$.blockUI({message:"<h4>Procesando...<\/h4>"})},success:function(n,t){t=="success"?n.success?$("#tbl").DataTable().ajax.reload():Mensajes.MostrarError(n.error):Mensajes.MostrarError("Se ha producido un error. Comuníquese con el administrador de ATSA.");$.unblockUI()}})})});$("#tbl").on("click",".btn-eliminar",function(n){var t=n.currentTarget.id;Mensajes.MostrarSiNo("¿Eliminar la liquidación?",function(){$.ajax({type:"POST",url:"Liquidacion/Eliminar",data:JSON.stringify({id:t}),dataType:"json",contentType:"application/json",beforeSend:function(){$.blockUI({message:"<h4>Procesando...<\/h4>"})},success:function(n,t){t=="success"?n.success?($.unblockUI(),$("#tbl").DataTable().ajax.reload()):Mensajes.MostrarError(n.error):(Mensajes.MostrarError("Se ha producido un error. Comuníquese con el administrador de ATSA."),$.unblockUI())}})},undefined)})});