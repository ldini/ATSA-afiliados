function ObtenerDiasCalendario(n){var t=n.split("/"),i=parseInt($("#Hoy").val());if(t.length==3){var u=parseInt(t[0]),f=parseInt(t[1]),r=parseInt(t[2]);i=parseInt(r/4)+r*365+f*30+u}return i}function Cancelar(){Mensajes.MostrarSiNo("¿Seguro que desea cancelar?",function(){location.href="liquidacion"})}function Grabar(){var n={LiquidacionPagoHijosDiscapacitadosId:parseInt($("#LiquidacionPagoHijosDiscapacitadosId").val()),Mes:parseInt($("#Mes").val()),Anio:parseInt($("#Anio").val()),Items:[]},t;if(isNaN(n.Mes)){Mensajes.MostrarError("Debe seleccionar el Mes.");return}if(isNaN(n.Anio)){Mensajes.MostrarError("Debe seleccionar el Año.");return}if(t=!1,$.each($("#tbl").dataTable().fnGetData(),function(t,i){if(!isNaN(parseInt(i[0]))){var r={Mes:n.Mes,Anio:n.Anio,Monto:parseFloat($("#tbl tr[index='"+t.toString()+"'] .monto").val()),CBU:$("#tbl tr[index='"+t.toString()+"'] .cbu").val(),BancoId:parseInt(i[2]),Afiliado:i[3],Hijo:i[4],AfiliadoId:parseInt(i[0]),HijoId:parseInt(i[1]),TipoCuentaBancariaId:parseInt($("#tbl tr[index='"+t.toString()+"'] .tipoCta").val()),TipoDoc:parseInt($("#tbl tr[index='"+t.toString()+"'] .tipoDoc").val()),CUIL:$("#tbl tr[index='"+t.toString()+"'] .cuil").val(),Observaciones:$("#tbl tr[index='"+t.toString()+"'] .observaciones").val(),Email:null,Vencimiento:$("#tbl tr[index='"+t.toString()+"'] .vencimiento").val()};n.Items.push(r)}}),!t){if(n.Items.length==0){Mensajes.MostrarError("Debe ingresar al menos un hijo para liquidar.");return}$.ajax({type:"POST",url:"/Liquidacion/Grabar",data:JSON.stringify({liquidacion:n}),dataType:"json",contentType:"application/json",beforeSend:function(){$.blockUI({message:"<h4>Procesando...<\/h4>"})},success:function(n,t){t=="success"?n.success?(window.open("/Liquidacion/Imprimir?id="+n.liquidacionId.toString(),"_blank"),location.href="Liquidacion"):(Mensajes.MostrarError(n.error),$.unblockUI()):(Mensajes.MostrarError("Se ha producido un error. Comuníquese con el administrador de ATSA."),$.unblockUI())}})}}var timeOutTypeAhead,hijos={},tblIndex=-1,bancos={};(function(){var n=new $.Event("style"),t=$.fn.css;$.fn.css=function(){return $(this).trigger(n),t.apply(this,arguments)}})();$(document).ready(function(){$("#Mes, #Anio, .tipoCta, .tipoDoc").chosen();var n=$("#tbl").dataTable({iDisplayLength:-1,bProcessing:!1,bServerSide:!1,bLengthChange:!1,scrollY:"300px",bFilter:!1,bSort:!1,bInfo:!1,bPaginate:!1,aoColumns:[{bSortable:!1,bVisible:!1},{bSortable:!1,bVisible:!1},{bSortable:!1,bVisible:!1},{bSortable:!1,bVisible:!1},{bSortable:!1,bVisible:!1},{bSortable:!1},{bSortable:!1},{bSortable:!1},{bSortable:!1},{bSortable:!1},{bSortable:!1},{bSortable:!1},{bSortable:!1},{bSortable:!1},{bSortable:!1,mRender:function(){return'<div class="btn btn-danger btn-sm quitar"><span class="glyphicon glyphicon-remove"><\/span><\/div>'}}]});$("#tbl").on("click",".quitar",function(){var n=$("#tbl").dataTable().fnGetPosition($(this).parents("tr")[0]);$("#tbl").dataTable().fnUpdate("",n,0,!1);$("#tbl").dataTable().fnUpdate("",n,1,!1);$("#tbl").dataTable().fnUpdate("",n,2,!1);$("#tbl").dataTable().fnUpdate("",n,3,!1);$("#tbl").dataTable().fnUpdate("",n,4,!1);$("#tbl tr[index='"+n+"'] input").val("");$("#tbl tr[index='"+n+"'] input.monto").val($("#MontoDefault").val());$("#tbl tr[index='"+n+"'] .tipoDoc").val("2").trigger("chosen:updated");$("#tbl tr[index='"+n+"'] .tipoCta").val("").trigger("chosen:updated");$("#tbl tr[index='"+n+"'] .vencimiento").val("");$("#tbl tr[index='"+n+"']").removeClass("proximoVencer")});$(".hijo").typeahead({minLength:1,items:20,matcher:function(){return!0},source:function(n,t){timeOutTypeAhead&&clearTimeout(timeOutTypeAhead);timeOutTypeAhead=setTimeout(function(){hijos={};$.ajax({type:"POST",url:"/Hijo/BuscarHijos",data:JSON.stringify({hijo:n}),dataType:"json",contentType:"application/json",success:function(n){objects=TypeAhead.constructMap(n.datos,hijos);t(objects)}})},500)},updater:function(n){return $("#HijoId").val(hijos[n].id),$("#AfiliadoId").val(hijos[n].afiliadoid),$("#Hijo").val(hijos[n].hijo),$("#Afiliado").val(hijos[n].afiliado),tblIndex=parseInt($($($($(this)[0])[0].$element[0]).parents("tr")[0]).attr("index")),$("#tbl").dataTable().fnUpdate(hijos[n].id,tblIndex,1,!1),$("#tbl").dataTable().fnUpdate(hijos[n].afiliadoid,tblIndex,0,!1),$("#tbl").dataTable().fnUpdate(hijos[n].hijo,tblIndex,4,!1),$("#tbl").dataTable().fnUpdate(hijos[n].afiliado,tblIndex,3,!1),$("tr[index='"+tblIndex+"'] .cuil").val(hijos[n].cuil),$("tr[index='"+tblIndex+"'] .vencimiento").val(hijos[n].vencimiento).trigger("blur"),hijos[n].cbu==null?$("tr[index='"+tblIndex+"'] .cbu").focus():($("tr[index='"+tblIndex+"'] .cbu").val(hijos[n].cbu),$("tr[index='"+tblIndex+"'] .tipoCta").val(hijos[n].tipoCtaId).trigger("chosen:updated"),$("tr[index='"+tblIndex+"'] .banco").val(hijos[n].banco),$("#tbl").dataTable().fnUpdate(hijos[n].bancoid,tblIndex,2,!1)),n}});$(".banco").typeahead({minLength:1,items:20,matcher:function(){return!0},source:function(n,t){bancos={};$.ajax({type:"POST",url:"/Hijo/BuscarBancos",data:JSON.stringify({bancos:n}),dataType:"json",contentType:"application/json",success:function(n){objects=TypeAhead.constructMap(n.datos,bancos);t(objects)}})},updater:function(n){return tblIndex=parseInt($($($($(this)[0])[0].$element[0]).parents("tr")[0]).attr("index")),$("#BancoId").val(bancos[n].id),$("#Banco").val(bancos[n].label),$("#tbl").dataTable().fnUpdate(bancos[n].id,tblIndex,2,!1),n}});$(".vencimiento").datetimepicker({format:"DD/MM/YYYY",widgetPositioning:{horizontal:"auto",vertical:"auto"}});$(".vencimiento").blur(function(){var n=$(this).val();n.length==10&&(n=ObtenerDiasCalendario(n),hoy=parseInt($("#Hoy").val()),n-hoy<=30?$($(this).parents("tr")[0]).addClass("proximoVencer"):$($(this).parents("tr")[0]).removeClass("proximoVencer"))}).trigger("blur");$('[data-toggle="tooltip"]').tooltip();jQuery(document).on("DOMNodeInserted","body",function(n){var t=n.target;if($(t).is(".dropdown-menu")){var r=$($(t).parents("td")[0]),i=$(r).find("input.form-control")[0],u=$(i).position().top+25,u=$($(".form-control.hijo")[0]).offset().top*-1+$(i).position().top+277;$(t).attr("newtop",u.toString())}})});setInterval(function(){$.each($("[newtop]"),function(n,t){$(t).css("top",$(t).attr("newtop")+"px").css("min-height","270px")})},150);